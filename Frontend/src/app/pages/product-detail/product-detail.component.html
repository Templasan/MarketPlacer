import { Component, inject, input } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ProductService } from '../../services/product.service';
import { toSignal } from '@angular/core/rxjs-interop';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';

@Component({
  selector: 'app-product-detail',
  standalone: true,
  imports: [CommonModule, MatButtonModule, MatIconModule],
  template: `
    @if (product(); as p) {
      <div class="container mx-auto px-4 py-10">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10 bg-white p-8 rounded-3xl shadow-sm">
          <img [src]="p.imagemURL" class="w-full rounded-2xl object-cover shadow-lg">
          
          <div class="flex flex-col gap-6">
            <span class="text-indigo-600 font-semibold uppercase tracking-wider">{{ p.categoria }}</span>
            <h1 class="text-4xl font-bold text-slate-900">{{ p.nome }}</h1>
            <p class="text-slate-600 text-lg leading-relaxed">{{ p.descricao }}</p>
            
            <div class="text-3xl font-bold text-green-600">
              {{ p.preco | currency:'BRL' }}
            </div>

            @if (product(); as p) {
  <button 
    mat-flat-button 
    color="primary" 
    class="!py-8 !text-xl !rounded-2xl w-full md:w-fit px-12 transition-transform active:scale-95"
    [disabled]="p.estoque <= 0"
    (click)="addToCart(p)">
    
    <mat-icon class="mr-2">add_shopping_cart</mat-icon> 
    {{ p.estoque > 0 ? 'Adicionar ao Carrinho' : 'Produto Esgotado' }}
  </button>
}
          </div>
        </div>
      </div>
    }
  `
})
export class ProductDetailComponent {
  // O Angular 18 captura o :id da URL automaticamente se o bind estiver ativo
  id = input.required<string>(); 
  private productService = inject(ProductService);

  // Busca o produto baseado no ID da URL
  product = toSignal(
    inject(ProductService).getProductById(Number(this.id()))
  );
}