<div class="min-h-screen bg-slate-50 p-4 md:p-8">
  <div class="container mx-auto">
    
    <button mat-button (click)="voltarHome()" class="mb-6 !text-slate-500 !rounded-xl hover:!bg-slate-200 transition-all">
      <mat-icon class="mr-1">arrow_back</mat-icon> Voltar para a Loja
    </button>
    
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
      <div>
        <h1 class="text-3xl font-black text-slate-900 tracking-tight flex items-center gap-3">
          <mat-icon class="scale-125 text-amber-500">dashboard</mat-icon>
          Painel do Vendedor
        </h1>
        <p class="text-slate-500">Gerencie seu estoque e acompanhe suas vendas</p>
      </div>
      
      <button mat-flat-button color="primary" (click)="openProductModal()" class="!rounded-2xl !py-6 !px-6 !font-bold">
        <mat-icon class="mr-2">add_box</mat-icon> Novo Produto
      </button>
    </div>

    <mat-tab-group class="seller-tabs bg-white rounded-[2rem] shadow-xl shadow-slate-200/60 overflow-hidden">
      
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="mr-2">inventory_2</mat-icon> Meu Estoque
        </ng-template>
        <div class="p-6 overflow-x-auto">
          <table mat-table [dataSource]="produtos()" class="w-full">
            <ng-container matColumnDef="imagem">
              <th mat-header-cell *matHeaderCellDef> Produto </th>
              <td mat-cell *matCellDef="let p" class="py-4">
                <div class="flex items-center gap-3">
                  <img [src]="p.imagemURL | imgUrl" class="w-12 h-12 rounded-lg object-cover bg-slate-100">
                  <span class="font-bold text-slate-800">{{p.nome}}</span>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="categoria">
              <th mat-header-cell *matHeaderCellDef> Categoria </th>
              <td mat-cell *matCellDef="let p"> 
                <span class="text-xs font-bold uppercase px-2 py-1 bg-slate-100 rounded text-slate-500">{{p.categoria}}</span>
              </td>
            </ng-container>
            <ng-container matColumnDef="preco">
              <th mat-header-cell *matHeaderCellDef> Pre√ßo </th>
              <td mat-cell *matCellDef="let p" class="font-bold text-indigo-600"> {{p.preco | currency:'BRL'}} </td>
            </ng-container>
            <ng-container matColumnDef="estoque">
              <th mat-header-cell *matHeaderCellDef> Estoque </th>
              <td mat-cell *matCellDef="let p"> {{p.estoque}} un. </td>
            </ng-container>
            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef> </th>
              <td mat-cell *matCellDef="let p" class="text-right">
                <button mat-icon-button (click)="openProductModal(p)"><mat-icon class="text-slate-400">edit</mat-icon></button>
                <button mat-icon-button (click)="confirmarExclusao(p.id)"><mat-icon class="text-rose-400">delete_outline</mat-icon></button>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['imagem', 'categoria', 'preco', 'estoque', 'acoes']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['imagem', 'categoria', 'preco', 'estoque', 'acoes'];"></tr>
          </table>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="mr-2">monetization_on</mat-icon> Vendas Recebidas
        </ng-template>

        <div class="p-6">
          <table mat-table [dataSource]="vendas()" multiTemplateDataRows class="w-full">
            
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef> Pedido </th>
              <td mat-cell *matCellDef="let v" class="font-mono text-xs font-bold"> #{{v.id}} </td>
            </ng-container>

            <ng-container matColumnDef="data">
              <th mat-header-cell *matHeaderCellDef> Data </th>
              <td mat-cell *matCellDef="let v"> {{v.orderDate | date:'dd/MM HH:mm'}} </td>
            </ng-container>

            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef> Total Venda </th>
              <td mat-cell *matCellDef="let v" class="font-black text-slate-900"> {{v.total | currency:'BRL'}} </td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> Status </th>
              <td mat-cell *matCellDef="let v">
                <button mat-button [matMenuTriggerFor]="menuStatus" 
                        class="!rounded-full !text-[10px] border px-3 py-0 h-8 font-black"
                        [ngClass]="getStatusColor(v.status)">
                  {{v.status}} <mat-icon class="!m-0">expand_more</mat-icon>
                </button>
                <mat-menu #menuStatus="matMenu">
                  <button mat-menu-item *ngIf="podeMudarPara(v.status, 'Enviado')" (click)="mudarStatus(v.id, 'Enviado')">üì¶ Enviado</button>
                  <button mat-menu-item *ngIf="podeMudarPara(v.status, 'Entregue')" (click)="mudarStatus(v.id, 'Entregue')">‚úÖ Entregue</button>
                  <button mat-menu-item *ngIf="podeMudarPara(v.status, 'Cancelado')" (click)="mudarStatus(v.id, 'Cancelado')">‚ùå Cancelar</button>
                </mat-menu>
              </td>
            </ng-container>

            <ng-container matColumnDef="expand">
              <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
              <td mat-cell *matCellDef="let v">
                <button mat-icon-button (click)="(expandedElement = expandedElement === v ? null : v); $event.stopPropagation()">
                  <mat-icon>{{expandedElement === v ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}}</mat-icon>
                </button>
              </td>
            </ng-container>

            <ng-container matColumnDef="expandedDetail">
              <td mat-cell *matCellDef="let v" [attr.colspan]="columnsVendas.length">
                <div class="overflow-hidden flex flex-col p-4 bg-slate-50 border-b"
                     [@detailExpand]="v == expandedElement ? 'expanded' : 'collapsed'">
                  
                  <h4 class="text-xs font-black uppercase text-slate-400 mb-3 flex items-center gap-2">
                    <mat-icon class="!text-sm !w-4 !h-4">list</mat-icon> Itens que voc√™ vendeu neste pedido
                  </h4>
                  
                  <div class="space-y-2">
                    @for (item of v.orderItems; track item.productId) {
                      <div class="flex justify-between items-center bg-white p-3 rounded-xl border border-slate-200">
                        <div class="flex flex-col">
                          <span class="font-bold text-slate-800">{{item.productName}}</span>
                          <span class="text-xs text-slate-500">ID do Produto: #{{item.productId}}</span>
                        </div>
                        <div class="text-right">
                          <div class="font-bold text-indigo-600">{{item.unitPrice | currency:'BRL'}}</div>
                          <div class="text-[10px] text-slate-400">{{item.quantity}} unidade(s)</div>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columnsVendas"></tr>
            <tr mat-row *matRowDef="let v; columns: columnsVendas;"
                class="element-row cursor-pointer hover:bg-slate-50"
                [class.expanded-row]="expandedElement === v"
                (click)="expandedElement = expandedElement === v ? null : v">
            </tr>
            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
          </table>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>